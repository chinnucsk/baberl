PACKAGE_NAME = @PACKAGE_NAME@
PACKAGE_VERSION = @PACKAGE_VERSION@
ERLC_FLAGS := -W
EBIN_DIR := ../ebin
EMULATOR := beam
ERLDIR = @ERLDIR@

all: ../include/baberl.hrl compile
	cp baberl.app ../ebin

compile:
	erl -make

clean:
	-rm -f $(EBIN_DIR)/*
	-rm -f ../include/baberl.hrl

install:
	install -d $(ERLDIR)/lib/$(PACKAGE_NAME)-$(PACKAGE_VERSION)
	cp -r `pwd`/../ebin $(ERLDIR)/lib/$(PACKAGE_NAME)-$(PACKAGE_VERSION)

package:
	install -d `pwd`/../.pkgtmp/$(PACKAGE_NAME)-$(PACKAGE_VERSION)/ebin
	cp -r `pwd`/../ebin/* `pwd`/../.pkgtmp/$(PACKAGE_NAME)-$(PACKAGE_VERSION)/ebin

../include/baberl.hrl:
	erlc $(ERLC_FLAGS) -I../include -o $(EBIN_DIR) baberl_generator.erl
	erl -pz $(EBIN_DIR) -noshell -eval "baberl_generator:generate_header(\"../include/baberl.hrl\")" -s init stop
	rm -f ../ebin/baberl_generator.beam